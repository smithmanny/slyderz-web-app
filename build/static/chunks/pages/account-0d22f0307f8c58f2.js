(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[966],{7017:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/account",function(){return n(7413)}])},7488:function(e,t,n){"use strict";var r=n(4924),a=n(6042),s=n(9396),i=n(9534),c=n(5893),o=n(6824),l=n(3156),u=(0,o.zo)(l.Z)((function(e){var t=e.theme;return(0,r.Z)({},t.breakpoints.up("md"),{padding:t.spacing(0)})}));t.Z=function(e){var t=e.children,n=(0,i.Z)(e,["children"]);return(0,c.jsx)(u,(0,s.Z)((0,a.Z)({},n),{children:t}))}},7413:function(e,t,n){"use strict";n.r(t),n.d(t,{__N_SSP:function(){return M},default:function(){return E}});var r=n(6042),a=n(828),s=n(5893),i=n(2750),c=n(7294),o=n(1631),l=n(1098),u=(0,n(6709)._)({resolverName:"getCurrentUser",resolverType:"query",routePath:"/getCurrentUser"}),d=n(5229),m=n(6509),h=n(7488),p=n(6886),x=n(5861),f=n(7677),v=n(7568),j=n(4051),w=n.n(j),Z=n(1163),g=n(4465),y=n(6664),N=n(6824),P=n(7357),b=(0,N.zo)("span")((function(e){return{display:"flex",alignItems:"center",marginLeft:e.theme.spacing(2)}})),_=(0,g.J)("pk_test_GrN77dvsAhUuGliIXge1nUD8"),k=function(e){var t=(0,Z.useRouter)(),n=(0,y.useStripe)(),r=(0,y.useElements)(),a=(0,c.useState)(null),i=(a[0],a[1]),o=function(){var e=(0,v.Z)(w().mark((function e(a){var s;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a.preventDefault(),n&&r){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,n.confirmSetup({elements:r,confirmParams:{return_url:"http://localhost:3000/account"}});case 5:(s=e.sent.error)?i(s.message):t.reload();case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),l=function(){var e=(0,v.Z)(w().mark((function e(n){var r,a;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=1,e.next=4,fetch("http://localhost:3000/api/stripe/destroy-payment-method",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({paymentMethodId:n})});case 4:return a=e.sent,e.next=7,a.json();case 7:r=e.sent,e.next=13;break;case 10:e.prev=10,e.t0=e.catch(1),console.log(e.t0);case 13:r&&t.reload();case 14:case"end":return e.stop()}}),e,null,[[1,10]])})));return function(t){return e.apply(this,arguments)}}();return e.paymentMethods.length>0?e.paymentMethods.map((function(e){return(0,s.jsxs)(P.Z,{sx:{display:"flex",alignItems:"center",mb:1},children:[(0,s.jsx)(x.Z,{children:e.card.last4}),(0,s.jsx)(b,{children:(0,s.jsx)(m.Z,{variant:"text",onClick:(0,v.Z)(w().mark((function t(){return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,l(e.id);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)}))),children:"Delete"})})]},e.id)})):(0,s.jsxs)(c.Fragment,{children:[(0,s.jsx)(y.PaymentElement,{id:"payment-element"}),(0,s.jsx)(m.Z,{type:"submit",sx:{mt:2},onClick:o,children:"Save Card"})]})},C=function(e){var t=e.clientSecret,n=e.paymentMethods,r={clientSecret:t,appearance:{theme:"stripe"}};return(0,s.jsx)(c.Fragment,{children:t&&(0,s.jsx)(y.Elements,{options:r,stripe:_,children:(0,s.jsx)(k,{paymentMethods:n})})})},S=function(e){var t=(0,a.Z)((0,i.Db)(o.Z),1)[0],n=(0,a.Z)((0,i.aM)(u,null),1)[0],d=e.setupIntent.client_secret,v={firstName:null===n||void 0===n?void 0:n.firstName,lastName:null===n||void 0===n?void 0:n.lastName,email:null===n||void 0===n?void 0:n.email};return(0,s.jsx)(c.Fragment,{children:(0,s.jsxs)(h.Z,{maxWidth:"sm",children:[(0,s.jsx)(x.Z,{variant:"h2",align:"center",children:"Your Account"}),(0,s.jsxs)(f.ZP,{submitText:"Update Password",schema:l.m3,initialValues:v,mutation:{schema:t,toVariables:function(e){return(0,r.Z)({},e)}},children:[(0,s.jsx)(x.Z,{variant:"h6",sx:{mt:6},children:(0,s.jsx)("strong",{children:"Update Password"})}),(0,s.jsx)(f.nv,{name:"password",label:"Current Password",placeholder:"Current Password"}),(0,s.jsx)(f.nv,{name:"newPassword1",label:"New Password",placeholder:"New Password"}),(0,s.jsx)(f.nv,{name:"newPassword2",label:"Confirm New Password",placeholder:"Confirm New Password"})]}),(0,s.jsxs)(f.ZP,{schema:l.m3,initialValues:v,mutation:{schema:t,toVariables:function(e){return(0,r.Z)({},e)}},children:[(0,s.jsx)(x.Z,{variant:"h6",sx:{mt:6},gutterBottom:!0,children:(0,s.jsx)("strong",{children:"Personal Info"})}),(0,s.jsxs)(p.ZP,{item:!0,container:!0,spacing:2,children:[(0,s.jsx)(f.nv,{disabled:!0,name:"firstName",label:"First Name",placeholder:"First Name",md:6}),(0,s.jsx)(f.nv,{disabled:!0,name:"lastName",label:"Last Name",placeholder:"Last Name",md:6})]})]}),(0,s.jsx)(x.Z,{variant:"h6",sx:{mt:6},gutterBottom:!0,children:(0,s.jsx)("strong",{children:"Payment Methods"})}),(0,s.jsx)(C,{clientSecret:d,paymentMethods:e.paymentMethods}),(0,s.jsx)(x.Z,{variant:"h6",sx:{mt:6},gutterBottom:!0,children:(0,s.jsx)("strong",{children:"Delete Your Account"})}),(0,s.jsx)(m.Z,{variant:"text",children:"Delete Account"})]})})};S.authenticate={redirectTo:"/"},S.getLayout=function(e){return(0,s.jsx)(d.Z,{children:e})};var M=!0,E=S}},function(e){e.O(0,[997,540,229,774,888,179],(function(){return t=7017,e(e.s=t);var t}));var t=e.O();_N_E=t}]);